{% extends "base-templates/base.html" %}
{% load thumbnail %}


{% block "css" %}
    {{block.super}}
<style type="text/css">
#sortable li, .addPod{width:100%; min-height:150px; margin: 1em; float: left; background:rgba(0, 0, 0, 0.2)}
.scenePod a {text-align:center; text-decoration:none;}
.scenePod p.story_title{font-size:1.2em;}
.scenePod p{margin:0.5em 0 0 0 ;}
.scenePod p.story_syn{text-align:left;margin:0.4em;}
.header{padding:1em; font-weight:bold; background:#f3d26c;}
.majorScene{background:url({{ MEDIA_URL }}images/icons/star-icon.png) no-repeat top right;}
</style>
{% endblock %}

{% block "javascript" %}
    {{block.super}}
    <script>
   
    var sorted = ""
    $(function() {
        $( "#sortable" ).sortable();
        $( "#sortable" ).disableSelection();
    });
    $( "#sortable" ).sortable({
        stop: function( event, ui ) {
            var sorted = $('#sortable').sortable('serialize');
            $.ajax({
                type: "POST",
                data: sorted + '&csrfmiddlewaretoken={{ csrf_token }}&active=true',
                url: "/sortscenes/",
                success:function(data) {
                    $( ".output" ).html(data)
                }
            });           
        }
    });
    </script>
{% endblock %}

{% block "main" %}
<p>Drag and drop to sort scenes.<span class="output"></span></p>

<div class="addPod">
    <a href="/chapter/add/" class="clearfix">
        <p class="chapter_title">add a chapter</p>
    </a>
</div>
<ul id="sortable">
    {% for sc in scenes %}
    <li id="scene_{{sc.pk}}">
    <div class="scenePod">
        <a  href="/scene/{{sc.pk}}">
        <h4 {% ifequal sc.importance 'MP' %}class="majorScene" title="Main plot"{% else %}title="Subplot"{% endifequal %}>{{sc}}</h4>
        <div class="charBio">
            <p><strong>Description:</strong> {{sc.description|striptags}}</p>
            <p><strong>Location:</strong>  {% for loc in sc.location.all %}{{ loc }}{% endfor %}</p>
            <p><strong>Viewpoint:</strong> {{sc.perspective}}</p>
            <p><strong>Characters:</strong> {% for char in sc.characters.all %}{{ char }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
            <p><strong>Artifacts:</strong> {% for arti in sc.artifacts.all %}{{ arti }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
            <p><strong>Status:</strong>{{ sc.get_status_display }}</p>
            <p>{{ sc.get_percentage_complete }}%</p>   
            {{ sc.order }}   
        </div>
        </a>
    </div>
    </li>
    {% endfor %}
</ul>
{% endblock %}


        

